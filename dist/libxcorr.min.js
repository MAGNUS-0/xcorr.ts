!function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=r(1),n=r(2);class a{constructor(t){this.processing=s.WA_XCORR,this.sampleRate=44100,this.setMode(t),this.gccphat=new i.Gccphat(this.sampleRate),this.waxcorr=new n.Waxcorr(this.sampleRate),this.prewhiten=o.NONE}async correlate(t,e){switch(this.prewhiten){case o.NONE:case o.MEAN_REMOVAL:case o.TREND_REMOVAL:}let r;return new Promise((i,n)=>{switch(this.processing){case s.GCC_PHAT:r=this.gccphat.xcorr(t,e),r=a.normalize(r),i(r);break;case s.WA_XCORR:this.waxcorr.xcorr(t,e).then(t=>{t=a.normalize(t),i(t)}).catch(t=>console.warn("Warning Waxcorr failed, offlineAudioContext not setup."));break;default:r=this.gccphat.xcorr(t,e),r=a.normalize(r),i(r)}})}async timeLag(t,e){const r=await this.correlate(t,e);return this.locatePeakIndex(r)}setMode(t){switch(t){case"waxcorr":this.processing=s.WA_XCORR;break;case"gccphat":this.processing=s.GCC_PHAT}}static indexOfMax(t){if(0===t.length)return-1;let e=t[0],r=0;for(var i=1;i<t.length;i++)t[i]>e&&(r=i,e=Math.abs(t[i]));return r}locatePeakIndex(t){let e,r=a.indexOfMax(t),i=0;return(i=this.processing===s.GCC_PHAT?r>Math.floor(t.length/2)?t.length-r:r:r-this.waxcorr.getOffset())>1?(e=a.interpolate(t[i-1],t[i],t[i+1]),e+=i):e=Math.abs(i),e}static interpolate(t,e,r){let i=.5*(t-r)/(t-2*e+r);return(Math.sqrt(i*i*32+1)-1)/(8*i)}static normalize(t){let e=0,r=new Float32Array(t.length);for(let r=0;r<t.length;r++)Math.abs(t[r])>e&&(e=Math.abs(t[r]));for(let i=0;i<t.length;i++)r[i]=t[i]/e;return r}}var s,o;!function(t){t.WA_XCORR="waxcorr",t.GCC_PHAT="gccphat"}(s||(s={})),function(t){t[t.NONE=0]="NONE",t[t.MEAN_REMOVAL=1]="MEAN_REMOVAL",t[t.TREND_REMOVAL=2]="TREND_REMOVAL"}(o||(o={})),window.xcorr=new a(s.WA_XCORR)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Gccphat=class{constructor(t){this.sampleRate=t,this.libmath=window.math,this.winmath=window.Math,window.initPulse||window.math?window.initPulse().then(t=>{this.pulse=t}):console.warn("GCC-PHAT was not setup correctly!")}xcorr(t,e){var r=this.forwardFFT(t),i=this.forwardFFT(e).conj(),a=n.multiply(r,i),s=a.abs(),o=n.divide(a,s),l=this.inverseFFT(o);return window.resXcorrMath=l,l}forwardFFT(t){void 0!==this.activeFFT&&this.free(),this.activeFFT=new this.pulse.fftReal(t.length);var e=this.activeFFT.forward(t);let r=this.extractReal(e),i=this.extractImag(e),a=new n(e.length);return a.setEntire(r,i),a}inverseFFT(t){let e=new Float32Array(2*t.length),r=0,i=0;for(let n=0;n<e.length;n++)n%2==0?(e[n]=t.data[r].re,r++):(e[n]=t.data[i].im,i++);let n=new Float32Array(e.length);return void 0!==this.activeFFT?(n=this.activeFFT.inverse(e),this.free()):console.warn("Error activeFFT not defined on GCC-PHAT handler!"),n}free(){this.activeFFT.dispose(),this.activeFFT=void 0}extractReal(t){if(t.length%2!=0)return new Float32Array(1);let e=new Float32Array(this.winmath.floor(t.length/2)),r=0;for(let i=0;i<t.length;i++)i%2==0&&(e[r]=t[i],r++);return e}extractImag(t){if(t.length%2!=0)return new Float32Array(1);let e=new Float32Array(this.winmath.floor(t.length/2)),r=0;for(let i=0;i<t.length;i++)i%2!=0&&(e[r]=t[i],r++);return e}};class i{constructor(t,e){this.data=window.math.complex(t,e)}}class n{constructor(t){this.length=t,this.data=new Array(t);for(let e=0;e<t;e++)this.data[e]=new i(0,0)}setEntire(t,e){let r=new Array(t.length);for(let i=0;i<t.length;i++)r[i]=window.math.complex(t[i],e[i]);this.data=r,this.length=this.data.length}conj(){let t=new n(this.length);for(let e=0;e<this.length;e++)t.data[e]=window.math.conj(this.data[e]);return t}abs(){let t=new n(this.length);for(let e=0;e<this.length;e++)t.data[e]=window.math.abs(this.data[e]);return t}static multiply(t,e){let r=new n(t.length);for(let i=0;i<t.length;i++)r.data[i]=window.math.multiply(t.data[i],e.data[i]);return r}static divide(t,e){let r=new n(t.length);for(let i=0;i<t.length;i++)r.data[i]=window.math.divide(t.data[i],e.data[i]);return r}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Waxcorr=class{constructor(t){this.offlineAudio=new i(t)}async calculate(t,e,r){return this.offlineAudio.setupGraph(t,e,r),this.offlineAudio.source0&&this.offlineAudio.source0.start(),this.offlineAudio.offlineAudioCtx?this.offlineAudio.offlineAudioCtx.startRendering():Promise.reject()}async xcorr(t,e){let r=t.length+e.length-1;return this.calculate(t,e,r).then(t=>new Promise(e=>{e(t.getChannelData(0))}))}getOffset(){return this.offlineAudio.getOffset()}};class i{constructor(t){this.reverseOffset=0,this.samplingRate=44100,this.samplingRate=t}getOffset(){return this.reverseOffset}setBiquad(t,e,r,i,n){e.gain.setValueAtTime(r,t.currentTime),e.frequency.setValueAtTime(i,t.currentTime),e.Q.setValueAtTime(n,t.currentTime)}free(){}setupGraph(t,e,r){this.offlineAudioCtx=new OfflineAudioContext(1,r,44100),this.source0=this.offlineAudioCtx.createBufferSource(),this.source1=this.offlineAudioCtx.createBufferSource(),this.convolver=this.offlineAudioCtx.createConvolver(),this.biquad0=this.offlineAudioCtx.createBiquadFilter(),this.buffer0=this.offlineAudioCtx.createBuffer(1,t.length,this.samplingRate),this.buffer1=this.offlineAudioCtx.createBuffer(1,e.length,this.samplingRate),this.buffer0.copyToChannel(t,0),this.buffer1.copyToChannel(e,0),this.source0.buffer=this.buffer0,this.source1.buffer=this.buffer1,Array.prototype.reverse.call(this.source1.buffer.getChannelData(0)),this.reverseOffset=this.buffer1.getChannelData(0).length-1,this.convolver.buffer=this.source1.buffer,this.source0.connect(this.convolver),this.convolver.connect(this.offlineAudioCtx.destination)}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL3hjb3JyLnRzIiwid2VicGFjazovLy8uL3NyYy9nY2NwaGF0LnRzIiwid2VicGFjazovLy8uL3NyYy93YXhjb3JyLnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiZ2NjcGhhdF8xIiwid2F4Y29ycl8xIiwiWGNvcnIiLCJbb2JqZWN0IE9iamVjdF0iLCJ0aGlzIiwicHJvY2Vzc2luZyIsIlByb2Nlc3NpbmdUeXBlIiwiV0FfWENPUlIiLCJzYW1wbGVSYXRlIiwic2V0TW9kZSIsImdjY3BoYXQiLCJHY2NwaGF0Iiwid2F4Y29yciIsIldheGNvcnIiLCJwcmV3aGl0ZW4iLCJQcmV3aGl0ZW5pbmdUeXBlIiwiTk9ORSIsImJ1ZmZlcjAiLCJidWZmZXIxIiwib3V0cHV0QnVmZmVyIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJ4Y29yciIsIm5vcm1hbGl6ZSIsInRoZW4iLCJjb3JyZWxhdGVkQnVmZmVyIiwiY2F0Y2giLCJfIiwiY29uc29sZSIsIndhcm4iLCJjb3JyZWxhdGUiLCJsb2NhdGVQZWFrSW5kZXgiLCJHQ0NfUEhBVCIsImJ1ZmZlciIsImxlbmd0aCIsIm1heCIsIm1heEluZGV4IiwiaW5kZXgiLCJNYXRoIiwiYWJzIiwiaW50ZXJwTGFnIiwiaWR4IiwiaW5kZXhPZk1heCIsInNhbXBsZUxhZyIsImZsb29yIiwiZ2V0T2Zmc2V0IiwiaW50ZXJwb2xhdGUiLCJwZWFrTTEiLCJwZWFrSWR4IiwicGVha1AxIiwibGFncmFuZ2VQZWFrIiwic3FydCIsIm1heFZhbHVlIiwiRmxvYXQzMkFycmF5IiwidGVtcEluZGV4Iiwid2luZG93IiwibGlibWF0aCIsIm1hdGgiLCJ3aW5tYXRoIiwiaW5pdFB1bHNlIiwicHVsc2UiLCJzcGVjdHJ1bTAiLCJmb3J3YXJkRkZUIiwic3BlY3RydW0xQ29uaiIsImNvbmoiLCJudW1lcmF0b3IiLCJDb21wbGV4RGF0YUFycmF5MUQiLCJtdWx0aXBseSIsImRlbm9taW5hdG9yIiwicmVzdWx0IiwiZGl2aWRlIiwidGltZVJlc3VsdCIsImludmVyc2VGRlQiLCJyZXNYY29yck1hdGgiLCJ1bmRlZmluZWQiLCJhY3RpdmVGRlQiLCJmcmVlIiwiZmZ0UmVhbCIsImZvcndhcmQiLCJyZSIsImV4dHJhY3RSZWFsIiwiaW0iLCJleHRyYWN0SW1hZyIsInNwZWN0cnVtIiwic2V0RW50aXJlIiwiZnJlcXVlbmN5QnVmZmVyIiwicmVDb3VudGVyIiwiaW1Db3VudGVyIiwiZGF0YSIsImludmVyc2UiLCJkaXNwb3NlIiwiY29tcGxleEZyZXFCdWZmZXIiLCJvdXRwdXQiLCJjb3VudGVyIiwiQ29tcGxleERhdGEiLCJjb21wbGV4IiwiQXJyYXkiLCJuZXdEYXRhIiwiY29uakFycmF5IiwiYWJzQXJyYXkiLCJzcGVjdHJ1bTEiLCJvZmZsaW5lQXVkaW8iLCJPZmZsaW5lQXVkaW9HcmFwaCIsImRldmljZUJ1ZmZlcjAiLCJkZXZpY2VCdWZmZXIxIiwib3V0cHV0QnVmZmVyTGVuZ3RoIiwic2V0dXBHcmFwaCIsInNvdXJjZTAiLCJzdGFydCIsIm9mZmxpbmVBdWRpb0N0eCIsInN0YXJ0UmVuZGVyaW5nIiwiY2FsY3VsYXRlIiwiY29ycmVsYXRlZEJ1ZmZlck5vZGUiLCJnZXRDaGFubmVsRGF0YSIsInNhbXBsaW5nUmF0ZSIsInJldmVyc2VPZmZzZXQiLCJjb250ZXh0IiwiYmlxdWFkIiwiZ2FpbiIsImZjIiwiUSIsInNldFZhbHVlQXRUaW1lIiwiY3VycmVudFRpbWUiLCJmcmVxdWVuY3kiLCJPZmZsaW5lQXVkaW9Db250ZXh0IiwiY3JlYXRlQnVmZmVyU291cmNlIiwic291cmNlMSIsImNvbnZvbHZlciIsImNyZWF0ZUNvbnZvbHZlciIsImJpcXVhZDAiLCJjcmVhdGVCaXF1YWRGaWx0ZXIiLCJjcmVhdGVCdWZmZXIiLCJjb3B5VG9DaGFubmVsIiwicmV2ZXJzZSIsImNvbm5lY3QiLCJkZXN0aW5hdGlvbiJdLCJtYXBwaW5ncyI6ImFBQ0EsSUFBQUEsRUFBQSxHQUdBLFNBQUFDLEVBQUFDLEdBR0EsR0FBQUYsRUFBQUUsR0FDQSxPQUFBRixFQUFBRSxHQUFBQyxRQUdBLElBQUFDLEVBQUFKLEVBQUFFLEdBQUEsQ0FDQUcsRUFBQUgsRUFDQUksR0FBQSxFQUNBSCxRQUFBLElBVUEsT0FOQUksRUFBQUwsR0FBQU0sS0FBQUosRUFBQUQsUUFBQUMsSUFBQUQsUUFBQUYsR0FHQUcsRUFBQUUsR0FBQSxFQUdBRixFQUFBRCxRQUtBRixFQUFBUSxFQUFBRixFQUdBTixFQUFBUyxFQUFBVixFQUdBQyxFQUFBVSxFQUFBLFNBQUFSLEVBQUFTLEVBQUFDLEdBQ0FaLEVBQUFhLEVBQUFYLEVBQUFTLElBQ0FHLE9BQUFDLGVBQUFiLEVBQUFTLEVBQUEsQ0FBMENLLFlBQUEsRUFBQUMsSUFBQUwsS0FLMUNaLEVBQUFrQixFQUFBLFNBQUFoQixHQUNBLG9CQUFBaUIsZUFBQUMsYUFDQU4sT0FBQUMsZUFBQWIsRUFBQWlCLE9BQUFDLFlBQUEsQ0FBd0RDLE1BQUEsV0FFeERQLE9BQUFDLGVBQUFiLEVBQUEsY0FBaURtQixPQUFBLEtBUWpEckIsRUFBQXNCLEVBQUEsU0FBQUQsRUFBQUUsR0FFQSxHQURBLEVBQUFBLElBQUFGLEVBQUFyQixFQUFBcUIsSUFDQSxFQUFBRSxFQUFBLE9BQUFGLEVBQ0EsS0FBQUUsR0FBQSxp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N0gsS0FBSzhILFFBQVU5SCxLQUFLMEcsZ0JBQWdCcUIscUJBR3BDL0gsS0FBS2EsUUFBVWIsS0FBSzBHLGdCQUFnQnNCLGFBQWEsRUFBRzVCLEVBQWNyRSxPQUFRL0IsS0FBSytHLGNBQy9FL0csS0FBS2MsUUFBVWQsS0FBSzBHLGdCQUFnQnNCLGFBQWEsRUFBRzNCLEVBQWN0RSxPQUFRL0IsS0FBSytHLGNBRy9FL0csS0FBS2EsUUFBUW9ILGNBQWM3QixFQUFlLEdBQzFDcEcsS0FBS2MsUUFBUW1ILGNBQWM1QixFQUFlLEdBRzFDckcsS0FBS3dHLFFBQVExRSxPQUFTOUIsS0FBS2EsUUFDM0JiLEtBQUsySCxRQUFRN0YsT0FBUzlCLEtBQUtjLFFBRzNCK0UsTUFBTXJHLFVBQVUwSSxRQUFRbkssS0FBS2lDLEtBQUsySCxRQUFRN0YsT0FBT2dGLGVBQWUsSUFHaEU5RyxLQUFLZ0gsY0FBZ0JoSCxLQUFLYyxRQUFRZ0csZUFBZSxHQUFHL0UsT0FBUyxFQUc3RC9CLEtBQUs0SCxVQUFVOUYsT0FBUzlCLEtBQUsySCxRQUFRN0YsT0FHckM5QixLQUFLd0csUUFBUTJCLFFBQVFuSSxLQUFLNEgsV0FDMUI1SCxLQUFLNEgsVUFBVU8sUUFBUW5JLEtBQUswRyxnQkFBZ0IwQiIsImZpbGUiOiJsaWJ4Y29yci5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7XG4iLCJpbXBvcnQgeyBHY2NwaGF0IH0gZnJvbSBcIi4vZ2NjcGhhdFwiO1xuaW1wb3J0IHsgV2F4Y29yciB9IGZyb20gJy4vd2F4Y29ycic7XG5cbi8qKlxuICogQGNsYXNzIFhjb3JyXG4gKiBAZGVzY3JpcHRpb24gQSB3ZWIgYmFzZWQgY3Jvc3MtY29ycmVsYXRpb24gY2xhc3MuXG4gKi9cbmNsYXNzIFhjb3JyIHtcblxuICAgIGdjY3BoYXQ6IEdjY3BoYXQ7XG4gICAgd2F4Y29ycjogV2F4Y29ycjtcbiAgICBwcmV3aGl0ZW46IFByZXdoaXRlbmluZ1R5cGU7XG4gICAgcHJvY2Vzc2luZzogUHJvY2Vzc2luZ1R5cGUgPSBQcm9jZXNzaW5nVHlwZS5XQV9YQ09SUjtcbiAgICBzYW1wbGVSYXRlOiBudW1iZXIgPSA0NDEwMDtcblxuICAgIC8qKlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBwYXJhbSBtb2RlIDogQ3Jvc3MtY29ycmVsYXRpb24gbW9kZVxuICAgICAqIEBwYXJhbSBwcmV3aGl0ZW4gIDogU2lnbmFsIHByZXdoaXRlbmluZyBtZXRob2RcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvciAobW9kZTogc3RyaW5nKSB7XG5cbiAgICAgICAgdGhpcy5zZXRNb2RlKG1vZGUpO1xuXG4gICAgICAgIHRoaXMuZ2NjcGhhdCA9IG5ldyBHY2NwaGF0KHRoaXMuc2FtcGxlUmF0ZSk7XG4gICAgICAgIHRoaXMud2F4Y29yciA9IG5ldyBXYXhjb3JyKHRoaXMuc2FtcGxlUmF0ZSk7XG4gICAgICAgIHRoaXMucHJld2hpdGVuID0gUHJld2hpdGVuaW5nVHlwZS5OT05FOyAgICAgICAgXG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGNvcnJlbGF0ZVxuICAgICAqIEBhc3luY1xuICAgICAqIEBwdWJsaWNcbiAgICAgKiBAcGFyYW0gYnVmZmVyMCA6IEZpcnN0IGJ1ZmZlciBmb3IgY3Jvc3MgY29ycmVsYXRpb24gXG4gICAgICogQHBhcmFtIGJ1ZmZlcjEgOiBTZWNvbmRhcnkgYnVmZmVyIG9mIGNyb3NzIGNvcnJlbGF0aW9uXG4gICAgICovXG4gICAgcHVibGljIGFzeW5jIGNvcnJlbGF0ZSAoYnVmZmVyMDogRmxvYXQzMkFycmF5LCBidWZmZXIxOiBGbG9hdDMyQXJyYXkpIHtcblxuICAgICAgICBzd2l0Y2ggKHRoaXMucHJld2hpdGVuKSB7XG4gICAgICAgICAgICBjYXNlIChQcmV3aGl0ZW5pbmdUeXBlLk5PTkUpOlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAoUHJld2hpdGVuaW5nVHlwZS5NRUFOX1JFTU9WQUwpOlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAoUHJld2hpdGVuaW5nVHlwZS5UUkVORF9SRU1PVkFMKTpcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBvdXRwdXRCdWZmZXI6IEZsb2F0MzJBcnJheTtcblxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgc3dpdGNoICh0aGlzLnByb2Nlc3NpbmcpIHtcbiAgICAgICAgICAgICAgICBjYXNlIChQcm9jZXNzaW5nVHlwZS5HQ0NfUEhBVCk6XG4gICAgICAgICAgICAgICAgICAgIG91dHB1dEJ1ZmZlciA9IHRoaXMuZ2NjcGhhdC54Y29ycihidWZmZXIwLCBidWZmZXIxKTtcbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0QnVmZmVyID0gWGNvcnIubm9ybWFsaXplKG91dHB1dEJ1ZmZlcik7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUob3V0cHV0QnVmZmVyKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAoUHJvY2Vzc2luZ1R5cGUuV0FfWENPUlIpOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLndheGNvcnIueGNvcnIoYnVmZmVyMCwgYnVmZmVyMSkudGhlbigoY29ycmVsYXRlZEJ1ZmZlcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29ycmVsYXRlZEJ1ZmZlciA9IFhjb3JyLm5vcm1hbGl6ZSg8RmxvYXQzMkFycmF5PmNvcnJlbGF0ZWRCdWZmZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShjb3JyZWxhdGVkQnVmZmVyKTtcbiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goXyA9PiBjb25zb2xlLndhcm4oJ1dhcm5pbmcgV2F4Y29yciBmYWlsZWQsIG9mZmxpbmVBdWRpb0NvbnRleHQgbm90IHNldHVwLicpKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0QnVmZmVyID0gdGhpcy5nY2NwaGF0Lnhjb3JyKGJ1ZmZlcjAsIGJ1ZmZlcjEpO1xuICAgICAgICAgICAgICAgICAgICBvdXRwdXRCdWZmZXIgPSBYY29yci5ub3JtYWxpemUob3V0cHV0QnVmZmVyKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvdXRwdXRCdWZmZXIpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCB0aW1lTGFnXG4gICAgICogQGFzeW5jXG4gICAgICogQHB1YmxpY1xuICAgICAqIEBwYXJhbSBidWZmZXIwIDogRmlyc3QgYnVmZmVyIGZvciBjcm9zcyBjb3JyZWxhdGlvbiBcbiAgICAgKiBAcGFyYW0gYnVmZmVyMSA6IFNlY29uZGFyeSBidWZmZXIgb2YgY3Jvc3MgY29ycmVsYXRpb25cbiAgICAgKi9cbiAgICBwdWJsaWMgYXN5bmMgdGltZUxhZyAoYnVmZmVyMDogRmxvYXQzMkFycmF5LCBidWZmZXIxOiBGbG9hdDMyQXJyYXkpIHtcblxuICAgICAgICBjb25zdCBjb3JyZWxhdGVkQnVmZmVyID0gYXdhaXQgdGhpcy5jb3JyZWxhdGUoYnVmZmVyMCwgYnVmZmVyMSk7XG4gICAgICAgIGxldCBsYWcgPSB0aGlzLmxvY2F0ZVBlYWtJbmRleCg8RmxvYXQzMkFycmF5PmNvcnJlbGF0ZWRCdWZmZXIpO1xuICAgIFxuICAgICAgICByZXR1cm4gbGFnO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwdWJsaWNcbiAgICAgKiBAbWV0aG9kXG4gICAgICogQHBhcmFtIG1vZGUgOiBOZXcgcHJvY2Vzc2luZyBtb2RlIHRvIHVzZSBmb3IgY3Jvc3MtY29ycmVsYXRpb25cbiAgICAgKi9cbiAgICBwdWJsaWMgc2V0TW9kZSAobW9kZTogc3RyaW5nKTogdm9pZCB7XG5cbiAgICAgICAgc3dpdGNoIChtb2RlKSB7XG4gICAgICAgICAgICBjYXNlICgnd2F4Y29ycicpOlxuICAgICAgICAgICAgICAgIHRoaXMucHJvY2Vzc2luZyA9IFByb2Nlc3NpbmdUeXBlLldBX1hDT1JSO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICgnZ2NjcGhhdCcpOlxuICAgICAgICAgICAgICAgIHRoaXMucHJvY2Vzc2luZyA9IFByb2Nlc3NpbmdUeXBlLkdDQ19QSEFUO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBpbmRleE9mTWF4XG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIGJ1ZmZlciA6IEJ1ZmZlciB0byBjYWxjdWxhdGUgbWF4aW11bSBpbmRleCBvZlxuICAgICAqL1xuICAgIHByaXZhdGUgc3RhdGljIGluZGV4T2ZNYXggKGJ1ZmZlcjogRmxvYXQzMkFycmF5KTogbnVtYmVyIHtcblxuICAgICAgICBpZiAoYnVmZmVyLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IG1heCA9IGJ1ZmZlclswXTtcbiAgICAgICAgbGV0IG1heEluZGV4ID0gMDtcblxuICAgICAgICBmb3IgKHZhciBpbmRleCA9IDE7IGluZGV4IDwgYnVmZmVyLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICAgICAgaWYgKGJ1ZmZlcltpbmRleF0gPiBtYXgpIHtcbiAgICAgICAgICAgICAgICBtYXhJbmRleCA9IGluZGV4O1xuICAgICAgICAgICAgICAgIG1heCA9IE1hdGguYWJzKGJ1ZmZlcltpbmRleF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG1heEluZGV4O1xuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBsb2NhdGVQZWFrSW5kZXhcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSBidWZmZXIgOiBCdWZmZXIgdG8gbG9jYXRlIHRoZSBwZWFrIGluZGV4XG4gICAgICovXG4gICAgcHJpdmF0ZSBsb2NhdGVQZWFrSW5kZXggKGJ1ZmZlcjogRmxvYXQzMkFycmF5KTogbnVtYmVyIHtcblxuICAgICAgICBsZXQgaWR4OiBudW1iZXIgPSBYY29yci5pbmRleE9mTWF4KGJ1ZmZlcik7XG5cbiAgICAgICAgbGV0IHNhbXBsZUxhZyA9IDA7XG5cbiAgICAgICAgaWYgKHRoaXMucHJvY2Vzc2luZyA9PT0gUHJvY2Vzc2luZ1R5cGUuR0NDX1BIQVQpIHtcbiAgICAgICAgICAgIGlmIChpZHggPiBNYXRoLmZsb29yKGJ1ZmZlci5sZW5ndGgvMikpIHtcbiAgICAgICAgICAgICAgICBzYW1wbGVMYWcgPSBidWZmZXIubGVuZ3RoIC0gaWR4O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzYW1wbGVMYWcgPSBpZHg7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzYW1wbGVMYWcgPSBpZHggLSB0aGlzLndheGNvcnIuZ2V0T2Zmc2V0KCk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgaW50ZXJwTGFnOiBudW1iZXI7XG5cbiAgICAgICAgaWYgKHNhbXBsZUxhZyA+IDEpIHtcbiAgICAgICAgICAgIGludGVycExhZyA9IFhjb3JyLmludGVycG9sYXRlKGJ1ZmZlcltzYW1wbGVMYWctMV0sIGJ1ZmZlcltzYW1wbGVMYWddLCBidWZmZXJbc2FtcGxlTGFnKzFdKTtcbiAgICAgICAgICAgIGludGVycExhZyArPSBzYW1wbGVMYWc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpbnRlcnBMYWcgPSBNYXRoLmFicyhzYW1wbGVMYWcpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGludGVycExhZztcblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgaW50ZXJwb2xhdGVcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0gcGVha00xIDogSW5kZXggYmVmb3JlIHBlYWsgaW5kZXhcbiAgICAgKiBAcGFyYW0gcGVha0lkeCA6IFBlYWsgaW5kZXhcbiAgICAgKiBAcGFyYW0gcGVha1AxIDogSW5kZXggYWZ0ZXIgcGVhayBpbmRleFxuICAgICAqL1xuICAgIHByaXZhdGUgc3RhdGljIGludGVycG9sYXRlIChwZWFrTTE6IG51bWJlciwgcGVha0lkeDogbnVtYmVyLCBwZWFrUDE6IG51bWJlcik6IG51bWJlciB7XG4gICAgICAgIFxuICAgICAgICBsZXQgbGFncmFuZ2VQZWFrID0gMC41ICogKHBlYWtNMSAtIHBlYWtQMSkgLyAocGVha00xIC0gKDIqcGVha0lkeCkgKyBwZWFrUDEpO1xuXG4gICAgICAgIGxldCBiaWFzQ29ycmVjdGVkID0gKE1hdGguc3FydCgzMiAqIChsYWdyYW5nZVBlYWsqbGFncmFuZ2VQZWFrKSArIDEpIC0gMSkgLyAoOCAqIGxhZ3JhbmdlUGVhayk7XG5cbiAgICAgICAgcmV0dXJuIGJpYXNDb3JyZWN0ZWQ7XG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIG5vcm1hbGl6ZVxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSBidWZmZXIgOiBCdWZmZXIgdG8gbm9ybWFsaXplXG4gICAgICovXG4gICAgcHJpdmF0ZSBzdGF0aWMgbm9ybWFsaXplIChidWZmZXI6IEZsb2F0MzJBcnJheSk6IEZsb2F0MzJBcnJheSB7XG5cbiAgICAgICAgbGV0IG1heFZhbHVlID0gMDtcbiAgICAgICAgbGV0IG91dHB1dEJ1ZmZlcjogRmxvYXQzMkFycmF5ID0gbmV3IEZsb2F0MzJBcnJheShidWZmZXIubGVuZ3RoKTtcblxuICAgICAgICBmb3IgKGxldCB0ZW1wSW5kZXggPSAwOyB0ZW1wSW5kZXggPCBidWZmZXIubGVuZ3RoOyB0ZW1wSW5kZXgrKykge1xuICAgICAgICAgICAgaWYgKE1hdGguYWJzKGJ1ZmZlclt0ZW1wSW5kZXhdKSA+IG1heFZhbHVlKXtcbiAgICAgICAgICAgICAgICBtYXhWYWx1ZSA9IE1hdGguYWJzKGJ1ZmZlclt0ZW1wSW5kZXhdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBidWZmZXIubGVuZ3RoOyBpbmRleCsrKXtcbiAgICAgICAgICAgIG91dHB1dEJ1ZmZlcltpbmRleF0gPSBidWZmZXJbaW5kZXhdL21heFZhbHVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG91dHB1dEJ1ZmZlcjtcblxuICAgIH1cblxufVxuXG4vKipcbiAqIEBlbnVtIFByb2Nlc3NpbmdUeXBlXG4gKi9cbmVudW0gUHJvY2Vzc2luZ1R5cGUge1xuICAgIFdBX1hDT1JSID0gJ3dheGNvcnInLFxuICAgIEdDQ19QSEFUID0gJ2djY3BoYXQnXG59O1xuXG4vKipcbiAqIEBlbnVtIFByZXdoaXRlbmluZ1R5cGVcbiAqL1xuZW51bSBQcmV3aGl0ZW5pbmdUeXBlIHtcbiAgICBOT05FLFxuICAgIE1FQU5fUkVNT1ZBTCxcbiAgICBUUkVORF9SRU1PVkFMXG59XG5cbi8vIEFwcGx5IHRvIHdpbmRvdyBmb3IgZWFzeSBKUyBjYWxsc1xuKDxhbnk+d2luZG93KS54Y29yciA9IG5ldyBYY29ycihQcm9jZXNzaW5nVHlwZS5XQV9YQ09SUik7IiwiLyoqXG4gKiBAY2xhc3MgR2NjcGhhdFxuICovXG5leHBvcnQgY2xhc3MgR2NjcGhhdCB7XG5cbiAgICBsaWJtYXRoOiBhbnk7XG4gICAgd2lubWF0aDogYW55O1xuICAgIHB1bHNlOiBhbnk7XG4gICAgYWN0aXZlRkZUOiBhbnk7XG4gICAgc2FtcGxlUmF0ZTogbnVtYmVyO1xuXG4gICAgLyoqXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQHBhcmFtIHNhbXBsZVJhdGUgOiBTYW1wbGUgcmF0ZSBvZiBkZXZpY2VcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvciAoc2FtcGxlUmF0ZTogbnVtYmVyKSB7XG5cbiAgICAgICAgdGhpcy5zYW1wbGVSYXRlID0gc2FtcGxlUmF0ZTtcbiAgICAgICAgdGhpcy5saWJtYXRoID0gKDxhbnk+d2luZG93KS5tYXRoO1xuICAgICAgICB0aGlzLndpbm1hdGggPSAoPGFueT53aW5kb3cpLk1hdGg7XG5cbiAgICAgICAgaWYgKCg8YW55PndpbmRvdykuaW5pdFB1bHNlIHx8ICg8YW55PndpbmRvdykubWF0aCkge1xuICAgICAgICAgICAgKDxhbnk+d2luZG93KS5pbml0UHVsc2UoKS50aGVuKChwdWxzZTogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5wdWxzZSA9IHB1bHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ0dDQy1QSEFUIHdhcyBub3Qgc2V0dXAgY29ycmVjdGx5IScpO1xuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIHhjb3JyXG4gICAgICogQGFzeW5jXG4gICAgICogQHB1YmxpY1xuICAgICAqIEBwYXJhbSBidWZmZXIwIDogRmlyc3QgYnVmZmVyIHRvIGNyb3NzIGNvcnJlbGF0ZVxuICAgICAqIEBwYXJhbSBidWZmZXIxIDogU2Vjb25kIGJ1ZmZlciB0byBjcm9zcyBjb3JyZWxhdGVcbiAgICAgKi9cbiAgICBwdWJsaWMgeGNvcnIgKGJ1ZmZlcjA6IEZsb2F0MzJBcnJheSwgYnVmZmVyMTogRmxvYXQzMkFycmF5KSB7XG5cbiAgICAgICAgLy8gQ29udmVydCBib3RoIHRvIGZyZXF1ZW5jeSBkb21haW5cbiAgICAgICAgdmFyIHNwZWN0cnVtMCA9IHRoaXMuZm9yd2FyZEZGVChidWZmZXIwKTtcbiAgICAgICAgdmFyIHNwZWN0cnVtMSA9IHRoaXMuZm9yd2FyZEZGVChidWZmZXIxKTtcblxuICAgICAgICAvLyBDb21wbGV4IGNvbmp1Z2F0ZSBcbiAgICAgICAgdmFyIHNwZWN0cnVtMUNvbmogPSBzcGVjdHJ1bTEuY29uaigpO1xuXG4gICAgICAgIC8vIENhbGN1bGF0ZSBudW1lcmF0b3JcbiAgICAgICAgdmFyIG51bWVyYXRvciA9IENvbXBsZXhEYXRhQXJyYXkxRC5tdWx0aXBseShzcGVjdHJ1bTAsIHNwZWN0cnVtMUNvbmopO1xuXG4gICAgICAgIC8vIEFic29sdXRlIG9mIHRoZSBudW1lcmF0b3JcbiAgICAgICAgdmFyIGRlbm9taW5hdG9yID0gbnVtZXJhdG9yLmFicygpO1xuXG4gICAgICAgIC8vIERpdmlkZSB0aGUgcmVzdWx0c1xuICAgICAgICB2YXIgcmVzdWx0ID0gQ29tcGxleERhdGFBcnJheTFELmRpdmlkZShudW1lcmF0b3IsIGRlbm9taW5hdG9yKTtcblxuICAgICAgICAvLyBDb252ZXJ0IHRvIHRpbWUgZG9tYWluXG4gICAgICAgIHZhciB0aW1lUmVzdWx0ID0gdGhpcy5pbnZlcnNlRkZUKHJlc3VsdCk7XG4gICAgICAgIFxuICAgICAgICAoPGFueT53aW5kb3cpLnJlc1hjb3JyTWF0aCA9IHRpbWVSZXN1bHQ7XG5cbiAgICAgICAgcmV0dXJuIHRpbWVSZXN1bHQ7XG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGZvcndhcmRGRlRcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSBidWZmZXIgOiBCdWZmZXIgdG8gdHJhbnNmb3JtXG4gICAgICovXG4gICAgcHJpdmF0ZSBmb3J3YXJkRkZUIChidWZmZXI6IEZsb2F0MzJBcnJheSk6IENvbXBsZXhEYXRhQXJyYXkxRCB7XG5cbiAgICAgICAgaWYgKHRoaXMuYWN0aXZlRkZUICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZnJlZSgpO1xuICAgICAgICB9IFxuXG4gICAgICAgIHRoaXMuYWN0aXZlRkZUID0gbmV3IHRoaXMucHVsc2UuZmZ0UmVhbChidWZmZXIubGVuZ3RoKTtcbiAgICAgICAgXG4gICAgICAgIHZhciByZXN1bHQ6IEZsb2F0MzJBcnJheSA9IHRoaXMuYWN0aXZlRkZULmZvcndhcmQoYnVmZmVyKTtcblxuICAgICAgICBsZXQgcmUgPSB0aGlzLmV4dHJhY3RSZWFsKHJlc3VsdCk7XG4gICAgICAgIGxldCBpbSA9IHRoaXMuZXh0cmFjdEltYWcocmVzdWx0KTtcblxuICAgICAgICBsZXQgc3BlY3RydW0gPSBuZXcgQ29tcGxleERhdGFBcnJheTFEKHJlc3VsdC5sZW5ndGgpO1xuICAgICAgICBzcGVjdHJ1bS5zZXRFbnRpcmUocmUsIGltKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBzcGVjdHJ1bTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGludmVyc2VGRlRcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSBzcGVjdHJ1bSA6IENvbXBsZXggZGF0YSBhcnJheSB0byBpbnZlcnNlIHRyYW5zZm9ybVxuICAgICAqL1xuICAgIHByaXZhdGUgaW52ZXJzZUZGVCAoc3BlY3RydW06IENvbXBsZXhEYXRhQXJyYXkxRCk6IEZsb2F0MzJBcnJheSB7XG5cbiAgICAgICAgbGV0IGZyZXF1ZW5jeUJ1ZmZlciA9IG5ldyBGbG9hdDMyQXJyYXkoc3BlY3RydW0ubGVuZ3RoICogMik7XG5cbiAgICAgICAgbGV0IHJlQ291bnRlciA9IDA7XG4gICAgICAgIGxldCBpbUNvdW50ZXIgPSAwO1xuICAgICAgICBcbiAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGZyZXF1ZW5jeUJ1ZmZlci5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgICAgIGlmIChpbmRleCUyID09PSAwKSB7XG4gICAgICAgICAgICAgICAgZnJlcXVlbmN5QnVmZmVyW2luZGV4XSA9IHNwZWN0cnVtLmRhdGFbcmVDb3VudGVyXS5yZTtcbiAgICAgICAgICAgICAgICByZUNvdW50ZXIrK1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmcmVxdWVuY3lCdWZmZXJbaW5kZXhdID0gc3BlY3RydW0uZGF0YVtpbUNvdW50ZXJdLmltO1xuICAgICAgICAgICAgICAgIGltQ291bnRlcisrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHJlc3VsdCA9IG5ldyBGbG9hdDMyQXJyYXkoZnJlcXVlbmN5QnVmZmVyLmxlbmd0aCk7XG5cbiAgICAgICAgaWYgKHRoaXMuYWN0aXZlRkZUICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMuYWN0aXZlRkZULmludmVyc2UoZnJlcXVlbmN5QnVmZmVyKTtcbiAgICAgICAgICAgIHRoaXMuZnJlZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKFwiRXJyb3IgYWN0aXZlRkZUIG5vdCBkZWZpbmVkIG9uIEdDQy1QSEFUIGhhbmRsZXIhXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgZnJlZVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcHJpdmF0ZSBmcmVlICgpIHtcbiAgICAgICAgdGhpcy5hY3RpdmVGRlQuZGlzcG9zZSgpO1xuICAgICAgICB0aGlzLmFjdGl2ZUZGVCA9IHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGV4dHJhY3RSZWFsXG4gICAgICogQHByaXZhdGUgXG4gICAgICogQHBhcmFtIGNvbXBsZXhGcmVxQnVmZmVyIDogRnJlcXVlbmN5IGJ1ZmZlciByZXR1cm5lZCBmcm9tIHB1bHNlRkZUXG4gICAgICovXG4gICAgcHJpdmF0ZSBleHRyYWN0UmVhbCAoY29tcGxleEZyZXFCdWZmZXI6IEZsb2F0MzJBcnJheSkge1xuXG4gICAgICAgIGlmIChjb21wbGV4RnJlcUJ1ZmZlci5sZW5ndGglMiAhPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBGbG9hdDMyQXJyYXkoMSk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgb3V0cHV0OiBGbG9hdDMyQXJyYXkgPSBuZXcgRmxvYXQzMkFycmF5KHRoaXMud2lubWF0aC5mbG9vcihjb21wbGV4RnJlcUJ1ZmZlci5sZW5ndGgvMikpO1xuICAgICAgICBsZXQgY291bnRlcjogbnVtYmVyID0gMDtcblxuICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgY29tcGxleEZyZXFCdWZmZXIubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgICAgICBpZiAoKGluZGV4ICUgMikgPT09IDApIHtcbiAgICAgICAgICAgICAgICBvdXRwdXRbY291bnRlcl0gPSBjb21wbGV4RnJlcUJ1ZmZlcltpbmRleF07XG4gICAgICAgICAgICAgICAgY291bnRlcisrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGV4dHJhY3RJbWFnXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0gY29tcGxleEZyZXFCdWZmZXIgOiBGcmVxdWVuY3kgYnVmZmVyIHJldHVybmVkIGZyb20gcHVsc2VGRlRcbiAgICAgKi9cbiAgICBwcml2YXRlIGV4dHJhY3RJbWFnIChjb21wbGV4RnJlcUJ1ZmZlcjogRmxvYXQzMkFycmF5KSB7XG5cbiAgICAgICAgaWYgKGNvbXBsZXhGcmVxQnVmZmVyLmxlbmd0aCUyICE9PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IEZsb2F0MzJBcnJheSgxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBvdXRwdXQ6IEZsb2F0MzJBcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkodGhpcy53aW5tYXRoLmZsb29yKGNvbXBsZXhGcmVxQnVmZmVyLmxlbmd0aC8yKSk7XG4gICAgICAgIGxldCBjb3VudGVyOiBudW1iZXIgPSAwO1xuXG4gICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBjb21wbGV4RnJlcUJ1ZmZlci5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgICAgIGlmICgoaW5kZXggJSAyKSAhPT0gMCkge1xuICAgICAgICAgICAgICAgIG91dHB1dFtjb3VudGVyXSA9IGNvbXBsZXhGcmVxQnVmZmVyW2luZGV4XTtcbiAgICAgICAgICAgICAgICBjb3VudGVyKys7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gb3V0cHV0O1xuICAgIH1cblxufVxuXG4vKipcbiAqIEBjbGFzcyBDb21wbGV4RGF0YVxuICovXG5jbGFzcyBDb21wbGV4RGF0YSB7XG5cbiAgICBkYXRhOiBPYmplY3Q7XG5cbiAgICAvKipcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAcGFyYW0gcmUgOiBSZWFsIG51bWJlciBvZiB0aGUgZGF0YVxuICAgICAqIEBwYXJhbSBpbSA6IEltYWdpbmFyeSBudW1iZXIgb2YgdGhlIGRhdGFcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvciAocmU6IG51bWJlciwgaW06IG51bWJlcikge1xuICAgICAgICB0aGlzLmRhdGEgPSAoPGFueT53aW5kb3cpLm1hdGguY29tcGxleChyZSwgaW0pO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAaW50ZXJmYWNlIENvbXBsZXhEYXRhXG4gKi9cbmludGVyZmFjZSBDb21wbGV4RGF0YSB7XG4gICAgZGF0YTogT2JqZWN0O1xuICAgIHJlOiBudW1iZXI7XG4gICAgaW06IG51bWJlcjtcbn1cblxuLyoqXG4gKiBAY2xhc3MgQ29tcGxleERhdGFBcnJheTFEXG4gKi9cbmNsYXNzIENvbXBsZXhEYXRhQXJyYXkxRCB7XG5cbiAgICBkYXRhOiBDb21wbGV4RGF0YVtdO1xuICAgIGxlbmd0aDogbnVtYmVyO1xuXG4gICAgLyoqXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQHBhcmFtIGxlbmd0aCA6IExlbmd0aCBvZiB0aGUgYXJyYXlcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvciAobGVuZ3RoOiBudW1iZXIpIHtcblxuICAgICAgICB0aGlzLmxlbmd0aCA9IGxlbmd0aDtcbiAgICAgICAgdGhpcy5kYXRhID0gbmV3IEFycmF5KGxlbmd0aCk7XG5cbiAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICAgICAgdGhpcy5kYXRhW2luZGV4XSA9IG5ldyBDb21wbGV4RGF0YSgwLDApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBzZXRFbnRpcmVcbiAgICAgKiBAcHVibGljXG4gICAgICogQHBhcmFtIHJlIDogQW4gYXJyYXkgb2YgMzIgYml0IGZsb2F0cyBvZiByZWFsIG51bWJlcnNcbiAgICAgKiBAcGFyYW0gaW0gOiBBbiBhcnJheSBvZiAzMiBiaXQgZmxvYXRzIG9mIGltYWdpbmFyeSBudW1iZXJzXG4gICAgICovXG4gICAgcHVibGljIHNldEVudGlyZSAocmU6IEZsb2F0MzJBcnJheSwgaW06IEZsb2F0MzJBcnJheSkge1xuXG4gICAgICAgIGxldCBuZXdEYXRhID0gbmV3IEFycmF5KHJlLmxlbmd0aCk7XG5cbiAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHJlLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICAgICAgbmV3RGF0YVtpbmRleF0gPSAoPGFueT53aW5kb3cpLm1hdGguY29tcGxleChyZVtpbmRleF0sIGltW2luZGV4XSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmRhdGEgPSBuZXdEYXRhO1xuICAgICAgICB0aGlzLmxlbmd0aCA9IHRoaXMuZGF0YS5sZW5ndGg7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBjb25qXG4gICAgICogQHB1YmxpY1xuICAgICAqL1xuICAgIHB1YmxpYyBjb25qICgpIDogQ29tcGxleERhdGFBcnJheTFEIHtcblxuICAgICAgICBsZXQgY29uakFycmF5ID0gbmV3IENvbXBsZXhEYXRhQXJyYXkxRCh0aGlzLmxlbmd0aCk7XG5cbiAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgICAgICBjb25qQXJyYXkuZGF0YVtpbmRleF0gPSAoPGFueT53aW5kb3cpLm1hdGguY29uaih0aGlzLmRhdGFbaW5kZXhdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBjb25qQXJyYXk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBhYnNcbiAgICAgKiBAcHVibGljXG4gICAgICovXG4gICAgcHVibGljIGFicyAoKSA6IENvbXBsZXhEYXRhQXJyYXkxRCB7XG5cbiAgICAgICAgbGV0IGFic0FycmF5ID0gbmV3IENvbXBsZXhEYXRhQXJyYXkxRCh0aGlzLmxlbmd0aCk7XG5cbiAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgICAgICBhYnNBcnJheS5kYXRhW2luZGV4XSA9ICg8YW55PndpbmRvdykubWF0aC5hYnModGhpcy5kYXRhW2luZGV4XSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYWJzQXJyYXk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBtdWx0aXBseVxuICAgICAqIEBwdWJsaWNcbiAgICAgKiBAcGFyYW0gc3BlY3RydW0wIDogQ29tcGxleCBkYXRhIHRvIGJlIG11bHRpcGxpZWRcbiAgICAgKiBAcGFyYW0gc3BlY3RydW0xIDogQ29tcGxleCBkYXRhIHRvIGJlIG11bHRpcGxpZWRcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIG11bHRpcGx5IChzcGVjdHJ1bTA6IENvbXBsZXhEYXRhQXJyYXkxRCwgc3BlY3RydW0xOiBDb21wbGV4RGF0YUFycmF5MUQpIDogQ29tcGxleERhdGFBcnJheTFEIHtcblxuICAgICAgICBsZXQgcmVzdWx0ID0gbmV3IENvbXBsZXhEYXRhQXJyYXkxRChzcGVjdHJ1bTAubGVuZ3RoKTtcblxuICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgc3BlY3RydW0wLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICAgICAgcmVzdWx0LmRhdGFbaW5kZXhdID0gKDxhbnk+d2luZG93KS5tYXRoLm11bHRpcGx5KHNwZWN0cnVtMC5kYXRhW2luZGV4XSwgc3BlY3RydW0xLmRhdGFbaW5kZXhdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBkaXZpZGVcbiAgICAgKiBAcHVibGljXG4gICAgICogQHBhcmFtIHNwZWN0cnVtMCA6IENvbXBsZXggZGF0YSB0byBiZSBkaXZpZGVkXG4gICAgICogQHBhcmFtIHNwZWN0cnVtMSA6IENvbXBsZXggZGF0YSB0byBiZSBkaXZpZGVkXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBkaXZpZGUgKHNwZWN0cnVtMDogQ29tcGxleERhdGFBcnJheTFELCBzcGVjdHJ1bTE6IENvbXBsZXhEYXRhQXJyYXkxRCkgOiBDb21wbGV4RGF0YUFycmF5MUQge1xuXG4gICAgICAgIGxldCByZXN1bHQgPSBuZXcgQ29tcGxleERhdGFBcnJheTFEKHNwZWN0cnVtMC5sZW5ndGgpO1xuXG4gICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBzcGVjdHJ1bTAubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgICAgICByZXN1bHQuZGF0YVtpbmRleF0gPSAoPGFueT53aW5kb3cpLm1hdGguZGl2aWRlKHNwZWN0cnVtMC5kYXRhW2luZGV4XSwgc3BlY3RydW0xLmRhdGFbaW5kZXhdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG59XG5cbi8qKlxuICogQGludGVyZmFjZSBPYmplY3RcbiAqL1xuaW50ZXJmYWNlIE9iamVjdCB7XG4gICAgcmU6IG51bWJlcjtcbiAgICBpbTogbnVtYmVyO1xufVxuXG5cbi8vIGxldCBnY2NwaGF0ID0gbmV3IEdjY3BoYXQoNDQxMDApO1xuLy8gY29uc29sZS5sb2coZ2NjcGhhdCk7XG5cbi8vIGxldCBidWZmZXIwID0gbmV3IEZsb2F0MzJBcnJheSg0MDApO1xuLy8gbGV0IGJ1ZmZlcjEgPSBuZXcgRmxvYXQzMkFycmF5KGJ1ZmZlcjAubGVuZ3RoKTtcblxuLy8gZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGJ1ZmZlcjAubGVuZ3RoOyBpbmRleCsrKSB7XG4vLyAgICAgYnVmZmVyMFtpbmRleF0gPSAoTWF0aC5yYW5kb20oKSAqIDIpIC0gMTtcbi8vICAgICBidWZmZXIxW2luZGV4XSA9IChNYXRoLnJhbmRvbSgpICogMikgLSAxO1xuLy8gfVxuXG4vLyBzZXRUaW1lb3V0KCgpPT57XG4vLyAgICAgdmFyIHJlc3VsdCA9IGdjY3BoYXQueGNvcnIoYnVmZmVyMCwgYnVmZmVyMSk7XG4vLyAgICAgY29uc29sZS5sb2coJ2djY3BoYXRfdHMnLCByZXN1bHQpXG4vLyB9LCAyMDAwKVxuXG4iLCJcbi8qKlxuICogQGNsYXNzIFdheGNvcnJcbiAqL1xuZXhwb3J0IGNsYXNzIFdheGNvcnIge1xuXG4gICAgb2ZmbGluZUF1ZGlvOiBPZmZsaW5lQXVkaW9HcmFwaDtcblxuICAgIC8qKlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBwYXJhbSBzYW1wbGVSYXRlIDogU2FtcGxpbmcgcmF0ZSBvZiBvZmZsaW5lIGF1ZGlvIGNvbnRleHQgcHJvY2Vzc2luZ1xuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yIChzYW1wbGVSYXRlOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5vZmZsaW5lQXVkaW8gPSBuZXcgT2ZmbGluZUF1ZGlvR3JhcGgoc2FtcGxlUmF0ZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBjYWxjdWxhdGVcbiAgICAgKiBAYXN5bmNcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSBkZXZpY2VCdWZmZXIwIDogQXVkaW8gYnVmZmVyIHRvIGNyb3NzIGNvcnJlbGF0ZVxuICAgICAqIEBwYXJhbSBkZXZpY2VCdWZmZXIxIDogU2Vjb25kIGF1ZGlvIGJ1ZmZlciB0byBjcm9zcyBjb3JyZWxhdGVcbiAgICAgKiBAcGFyYW0gb3V0cHV0QnVmZmVyTGVuZ3RoIDogT3V0cHV0IGF1ZGlvIGJ1ZmZlciBsZW5ndGggZXhwZWN0ZWRcbiAgICAgKi9cbiAgICBwcml2YXRlIGFzeW5jIGNhbGN1bGF0ZSAoZGV2aWNlQnVmZmVyMDogRmxvYXQzMkFycmF5LCBkZXZpY2VCdWZmZXIxOiBGbG9hdDMyQXJyYXksIG91dHB1dEJ1ZmZlckxlbmd0aDogbnVtYmVyKSB7XG5cbiAgICAgICAgLy8gU2V0dXAgYXVkaW8gZ3JhcGggYmVmb3JlIGNvcnJlbGF0aW9uXG4gICAgICAgIHRoaXMub2ZmbGluZUF1ZGlvLnNldHVwR3JhcGgoZGV2aWNlQnVmZmVyMCwgZGV2aWNlQnVmZmVyMSwgb3V0cHV0QnVmZmVyTGVuZ3RoKTtcblxuICAgICAgICAvLyBTdGFydCBidWZmZXIgcGxheWluZ1xuICAgICAgICBpZiAodGhpcy5vZmZsaW5lQXVkaW8uc291cmNlMCkge1xuICAgICAgICAgICAgdGhpcy5vZmZsaW5lQXVkaW8uc291cmNlMC5zdGFydCgpXG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5vZmZsaW5lQXVkaW8ub2ZmbGluZUF1ZGlvQ3R4KSB7XG4gICAgICAgICAgICAvLyBXYWl0IGZvciBjb250ZXh0IHRvIGNvbXBsZXRlXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5vZmZsaW5lQXVkaW8ub2ZmbGluZUF1ZGlvQ3R4LnN0YXJ0UmVuZGVyaW5nKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoKTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCB4Y29yclxuICAgICAqIEBhc3luY1xuICAgICAqIEBwdWJsaWNcbiAgICAgKiBAcGFyYW0gYnVmZmVyMCA6IEZpcnN0IGJ1ZmZlciB0byBjcm9zcyBjb3JyZWxhdGVcbiAgICAgKiBAcGFyYW0gYnVmZmVyMSA6IFNlY29uZCBidWZmZXIgdG8gY3Jvc3MgY29ycmVsYXRlXG4gICAgICovXG4gICAgcHVibGljIGFzeW5jIHhjb3JyIChidWZmZXIwOiBGbG9hdDMyQXJyYXksIGJ1ZmZlcjE6IEZsb2F0MzJBcnJheSkge1xuICAgICAgICBsZXQgb3V0cHV0QnVmZmVyTGVuZ3RoID0gYnVmZmVyMC5sZW5ndGggKyBidWZmZXIxLmxlbmd0aCAtIDE7XG4gICAgICAgIHJldHVybiB0aGlzLmNhbGN1bGF0ZShidWZmZXIwLCBidWZmZXIxLCBvdXRwdXRCdWZmZXJMZW5ndGgpLnRoZW4oKGNvcnJlbGF0ZWRCdWZmZXJOb2RlKT0+e1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgICAgICAgICAgIHJlc29sdmUoKDxBdWRpb0J1ZmZlcj5jb3JyZWxhdGVkQnVmZmVyTm9kZSkuZ2V0Q2hhbm5lbERhdGEoMCkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgZ2V0T2Zmc2V0XG4gICAgICogQHB1YmxpY1xuICAgICAqL1xuICAgIHB1YmxpYyBnZXRPZmZzZXQgKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLm9mZmxpbmVBdWRpby5nZXRPZmZzZXQoKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGNsYXNzIE9mZmxpbmVBdWRpb0dyYXBoXG4gKi9cbmNsYXNzIE9mZmxpbmVBdWRpb0dyYXBoIHtcblxuICAgIG9mZmxpbmVBdWRpb0N0eD86IE9mZmxpbmVBdWRpb0NvbnRleHQ7XG4gICAgcmV2ZXJzZU9mZnNldDogbnVtYmVyID0gMDtcbiAgICBjb252b2x2ZXI/OiBDb252b2x2ZXJOb2RlO1xuICAgIHNvdXJjZTA/OiBBdWRpb0J1ZmZlclNvdXJjZU5vZGU7XG4gICAgc291cmNlMT86IEF1ZGlvQnVmZmVyU291cmNlTm9kZTtcbiAgICBidWZmZXIwPzogQXVkaW9CdWZmZXI7XG4gICAgYnVmZmVyMT86IEF1ZGlvQnVmZmVyO1xuICAgIGJpcXVhZDA/OiBCaXF1YWRGaWx0ZXJOb2RlO1xuICAgIHNhbXBsaW5nUmF0ZTogbnVtYmVyID0gNDQxMDA7XG5cbiAgICAvKipcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAcGFyYW0gc2FtcGxpbmdSYXRlIDogU2FtcGxpbmcgcmF0ZSBvZiBvZmZsaW5lIGF1ZGlvIGNvbnRleHRcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvciAoc2FtcGxpbmdSYXRlOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5zYW1wbGluZ1JhdGUgPSBzYW1wbGluZ1JhdGU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBnZXRPZmZzZXRcbiAgICAgKiBAcHVibGljXG4gICAgICovXG4gICAgcHVibGljIGdldE9mZnNldCAoKSA6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLnJldmVyc2VPZmZzZXQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBzZXRCaXF1YWRcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSBjb250ZXh0IDogT2ZmbGluZSBhdWRpbyBjb250ZXh0XG4gICAgICogQHBhcmFtIGJpcXVhZCA6IEJpcXVhZEZpbHRlck5vZGUgb2JqZWN0IHJlZmVyZW5jZVxuICAgICAqIEBwYXJhbSBnYWluIDogR2FpbiBvZiBmaWx0ZXIgdG8gc2V0XG4gICAgICogQHBhcmFtIGZjIDogQ3V0b2ZmIGZyZXF1ZW5jeSB0byBzZXRcbiAgICAgKiBAcGFyYW0gUSA6IFEtZmFjdG9yIHRvIHNldFxuICAgICAqL1xuICAgIHByaXZhdGUgc2V0QmlxdWFkIChjb250ZXh0OiBPZmZsaW5lQXVkaW9Db250ZXh0LCBiaXF1YWQ6IEJpcXVhZEZpbHRlck5vZGUsIGdhaW46IG51bWJlciwgZmM6IG51bWJlciwgUTogbnVtYmVyKTogdm9pZCB7XG5cbiAgICAgICAgYmlxdWFkLmdhaW4uc2V0VmFsdWVBdFRpbWUoZ2FpbiwgY29udGV4dC5jdXJyZW50VGltZSk7XG5cbiAgICAgICAgYmlxdWFkLmZyZXF1ZW5jeS5zZXRWYWx1ZUF0VGltZShmYywgY29udGV4dC5jdXJyZW50VGltZSk7XG4gICAgICAgIFxuICAgICAgICBiaXF1YWQuUS5zZXRWYWx1ZUF0VGltZShRLCBjb250ZXh0LmN1cnJlbnRUaW1lKTtcblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgZnJlZVxuICAgICAqIEBwdWJsaWNcbiAgICAgKi9cbiAgICBwdWJsaWMgZnJlZSAoKSB7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBzZXR1cEdyYXBoXG4gICAgICogQHB1YmxpY1xuICAgICAqIEBwYXJhbSBkZXZpY2VCdWZmZXIwIDogQXVkaW8gYnVmZmVyIHRvIGNyb3NzIGNvcnJlbGF0ZVxuICAgICAqIEBwYXJhbSBkZXZpY2VCdWZmZXIxIDogU2Vjb25kIGF1ZGlvIGJ1ZmZlciB0byBjcm9zcyBjb3JyZWxhdGVcbiAgICAgKiBAcGFyYW0gb3V0cHV0QnVmZmVyTGVuZ3RoIDogT3V0cHV0IGF1ZGlvIGJ1ZmZlciBsZW5ndGggZXhwZWN0ZWRcbiAgICAgKi9cbiAgICBwdWJsaWMgc2V0dXBHcmFwaCAoZGV2aWNlQnVmZmVyMDogRmxvYXQzMkFycmF5LCBkZXZpY2VCdWZmZXIxOiBGbG9hdDMyQXJyYXksIG91dHB1dEJ1ZmZlckxlbmd0aDogbnVtYmVyKTogdm9pZCB7XG5cbiAgICAgICAgdGhpcy5vZmZsaW5lQXVkaW9DdHggPSBuZXcgT2ZmbGluZUF1ZGlvQ29udGV4dCgxLCBvdXRwdXRCdWZmZXJMZW5ndGgsIDQ0MTAwKTtcblxuICAgICAgICAvLyBDcmVhdGUgbm9kZXNcbiAgICAgICAgdGhpcy5zb3VyY2UwID0gdGhpcy5vZmZsaW5lQXVkaW9DdHguY3JlYXRlQnVmZmVyU291cmNlKCk7XG4gICAgICAgIHRoaXMuc291cmNlMSA9IHRoaXMub2ZmbGluZUF1ZGlvQ3R4LmNyZWF0ZUJ1ZmZlclNvdXJjZSgpO1xuICAgICAgICB0aGlzLmNvbnZvbHZlciA9IHRoaXMub2ZmbGluZUF1ZGlvQ3R4LmNyZWF0ZUNvbnZvbHZlcigpO1xuICAgICAgICB0aGlzLmJpcXVhZDAgPSB0aGlzLm9mZmxpbmVBdWRpb0N0eC5jcmVhdGVCaXF1YWRGaWx0ZXIoKTtcblxuICAgICAgICAvLyBDcmVhdGUgYXVkaW8gYnVmZmVyc1xuICAgICAgICB0aGlzLmJ1ZmZlcjAgPSB0aGlzLm9mZmxpbmVBdWRpb0N0eC5jcmVhdGVCdWZmZXIoMSwgZGV2aWNlQnVmZmVyMC5sZW5ndGgsIHRoaXMuc2FtcGxpbmdSYXRlKTtcbiAgICAgICAgdGhpcy5idWZmZXIxID0gdGhpcy5vZmZsaW5lQXVkaW9DdHguY3JlYXRlQnVmZmVyKDEsIGRldmljZUJ1ZmZlcjEubGVuZ3RoLCB0aGlzLnNhbXBsaW5nUmF0ZSk7XG5cbiAgICAgICAgLy8gU2V0IHRoZSBhdWRpbyBidWZmZXJzXG4gICAgICAgIHRoaXMuYnVmZmVyMC5jb3B5VG9DaGFubmVsKGRldmljZUJ1ZmZlcjAsIDApO1xuICAgICAgICB0aGlzLmJ1ZmZlcjEuY29weVRvQ2hhbm5lbChkZXZpY2VCdWZmZXIxLCAwKTtcblxuICAgICAgICAvLyBTZXQgdGhlIGJ1ZmZlciBub2RlcyB0byB0aGUgbmV3IGF1ZGlvIGJ1ZmZlcnNcbiAgICAgICAgdGhpcy5zb3VyY2UwLmJ1ZmZlciA9IHRoaXMuYnVmZmVyMDtcbiAgICAgICAgdGhpcy5zb3VyY2UxLmJ1ZmZlciA9IHRoaXMuYnVmZmVyMTtcblxuICAgICAgICAvLyBSZXZlcnNlIHNlY29uZCBidWZmZXJcbiAgICAgICAgQXJyYXkucHJvdG90eXBlLnJldmVyc2UuY2FsbCh0aGlzLnNvdXJjZTEuYnVmZmVyLmdldENoYW5uZWxEYXRhKDApKTtcblxuICAgICAgICAvLyBTdG9yZSB0aGUgcmV2ZXJzZSBvZmZzZXQgXG4gICAgICAgIHRoaXMucmV2ZXJzZU9mZnNldCA9IHRoaXMuYnVmZmVyMS5nZXRDaGFubmVsRGF0YSgwKS5sZW5ndGggLSAxO1xuXG4gICAgICAgIC8vIFNldCB0aGUgY29udm9sdXRpb24gYnVmZmVyXG4gICAgICAgIHRoaXMuY29udm9sdmVyLmJ1ZmZlciA9IHRoaXMuc291cmNlMS5idWZmZXI7XG5cbiAgICAgICAgLy8gQ29ubmVjdCB1cCBwcm9jZXNzaW5nIGdyYXBoXG4gICAgICAgIHRoaXMuc291cmNlMC5jb25uZWN0KHRoaXMuY29udm9sdmVyKTtcbiAgICAgICAgdGhpcy5jb252b2x2ZXIuY29ubmVjdCh0aGlzLm9mZmxpbmVBdWRpb0N0eC5kZXN0aW5hdGlvbik7XG5cbiAgICB9XG5cbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=